apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: inventory-system

bases:
  - ../../base

namePrefix: qa-

patches:
  - target:
      kind: Deployment
      name: inventory-system-app
    patch: |-
      - op: replace
        path: /spec/replicas
        value: 2
      - op: replace
        path: /spec/template/spec/volumes/0/csi/volumeAttributes/secretProviderClass
        value: "qa-azure-keyvault-secrets"
  - target:
      kind: SecretProviderClass
      name: azure-keyvault-secrets
    patch: |-
      - op: replace
        path: /spec/parameters/userAssignedIdentityID
        value: "0153744c-89ef-489f-84e4-816e3c12ea88"
      - op: replace
        path: /spec/parameters/keyvaultName
        value: "kv-appg5-qa"
  - target:
      kind: ConfigMap
      name: inventory-config
    patch: |-
      - op: replace
        path: /data/ENV
        value: "qa"

commonLabels:
  environment: qa
